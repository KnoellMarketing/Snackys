<?php
$AeZNHPsPQMZGJTV = Shop::DB()->query('SELECT nStatus FROM tplugin WHERE cVerzeichnis=\'km_snackys\'',1); if(!$AeZNHPsPQMZGJTV || !isset($AeZNHPsPQMZGJTV->nStatus) || $AeZNHPsPQMZGJTV->nStatus != 2) die('<html><head><title>Sorry</title><link
href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600,700" rel="stylesheet">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style type="text/css">
body {font-family:\'Source Sans Pro\',\'Helvetica Neue\',\'Helvetica\',\'Arial\',sans-serif;}
#box {max-width: 900px; margin: 0 auto;margin-top: 80px;width:80%;}
h2 {background: linear-gradient( 90deg, rgb(255,94,77) 0%, rgb(255,131,77) 0%, rgb(255,154,86) 0%, rgb(248,85,88) 100%); color: #fff;margin:0;padding: 20px 50px;}
p {padding: 50px; background: #f0f0f0;margin:0;}
</style></head><body><div id="box"><h2>Sorry.</h2><p>Plugin::Snackys is missing.</p></div></body></html>'); $smarty->registerPlugin('function', 'loadCSS', 'loadCSS'); $smarty->registerPlugin('function', 'imagePreloadLogo', 'imagePreloadLogo'); $smarty->registerPlugin('function', 'getSizeBySrc', 'getSizeBySrc'); $smarty->registerPlugin('function', 'readJs', 'readJs'); $smarty->registerPlugin('function', 'snackysBasics', 'snackysBasics'); $smarty->registerPlugin('function', 'getZahlungsarten', 'getZahlungsarten'); $smarty->registerPlugin('modifier', 'checkCopyfree', 'checkCopyfree'); $smarty->registerPlugin('modifier', 'optimize', 'optimize'); $smarty->registerPlugin('function', 'checkShowMatrix', 'checkShowMatrix'); function snackysBasics($hDYxSEllgaqgsbd,&$smarty) { if($smarty->get_template_vars('bAjaxRequest') === false) { $LBuAbDETzjvuKhg = $smarty->get_template_vars('Einstellungen')['template']; $lJYTnVvZQTXqxCV = $smarty->get_template_vars('nTemplateVersion'); $NlPYFIEUqaatBfr = array( array( 'file' => 'img/preload/1x1.png', 'as' => 'image' ) ); if($LBuAbDETzjvuKhg['general']['use_minify'] != 'N') $NlPYFIEUqaatBfr[] = array( 'file' => 'asset/plugin_js_head?v='.$lJYTnVvZQTXqxCV, 'as' => 'script', 'fromRoot' => true ); if($LBuAbDETzjvuKhg['general']['optimize_jquery'] == 'E') $NlPYFIEUqaatBfr[] = array( 'file' => 'js/jquery.js', 'as' => 'script' ); $UrhtqiJHfXrQLgA = $smarty->get_template_vars('currentTemplateDir'); $xZjbSXZZUjtckHY = $smarty->get_template_vars('parentTemplateDir'); $PsmvUUobKWETpIz = (trim($xZjbSXZZUjtckHY) != '') ? $xZjbSXZZUjtckHY : $UrhtqiJHfXrQLgA; $eWttOVZvZccDfFA = ''; $qtNhkLWIYMASwgA = trim($LBuAbDETzjvuKhg['general']['cdnDomain']); if(substr($qtNhkLWIYMASwgA,-1) != '/') $qtNhkLWIYMASwgA .= '/'; $xFyRbgNCGCbCXmR = ''; $uWmbICrJiIbqGxk = parse_url(URL_SHOP); if(trim($LBuAbDETzjvuKhg['general']['cdnDomain']) != '') { $PsmvUUobKWETpIz = $qtNhkLWIYMASwgA.$PsmvUUobKWETpIz; $eWttOVZvZccDfFA = $qtNhkLWIYMASwgA; $jCWqdEDgkFlwjaj = '<link rel="dns-prefetch" href="'.substr($qtNhkLWIYMASwgA,0,strlen($qtNhkLWIYMASwgA)-1).'">'; foreach($NlPYFIEUqaatBfr as $wXjpgMUSYBUUMqv) { $jCWqdEDgkFlwjaj .= '<link rel="preload" href="'.$PsmvUUobKWETpIz.$wXjpgMUSYBUUMqv['file'].'" as="'.$wXjpgMUSYBUUMqv['as'].'">'; } $smarty->assign('snackysBasics', $jCWqdEDgkFlwjaj); } elseif(!isset($_COOKIE["h2pushes"])) { $jCWqdEDgkFlwjaj = ''; $ZwoQXAJzyIrrpwB = $uWmbICrJiIbqGxk['path'].$PsmvUUobKWETpIz; $xIrgHDMcELHusmL = $uWmbICrJiIbqGxk['path']; foreach($NlPYFIEUqaatBfr as $wXjpgMUSYBUUMqv) { $bpHzyQNRpPKtuak = isset($wXjpgMUSYBUUMqv['fromRoot']) ? $xIrgHDMcELHusmL : $ZwoQXAJzyIrrpwB; $jCWqdEDgkFlwjaj .= '<'.$bpHzyQNRpPKtuak.$wXjpgMUSYBUUMqv['file'].'>; rel=preload; as='.$wXjpgMUSYBUUMqv['as'].', '; } $jCWqdEDgkFlwjaj = substr($jCWqdEDgkFlwjaj,0,strlen($jCWqdEDgkFlwjaj)-2); header("Link: ".$jCWqdEDgkFlwjaj); setcookie("h2pushes", 1, time()+$LBuAbDETzjvuKhg['general']['pushCacheTime']); $smarty->assign('snackysBasics', ''); $PsmvUUobKWETpIz =$uWmbICrJiIbqGxk['path'].$PsmvUUobKWETpIz; $eWttOVZvZccDfFA =$uWmbICrJiIbqGxk['path']; } else { $smarty->assign('snackysBasics', ''); $PsmvUUobKWETpIz =$uWmbICrJiIbqGxk['path'].$PsmvUUobKWETpIz; $eWttOVZvZccDfFA =$uWmbICrJiIbqGxk['path']; } $smarty->assign('snackysTemplate',$PsmvUUobKWETpIz); Shop::Smarty()->assign('snackysTemplate',$PsmvUUobKWETpIz); $smarty->assign('snackysTemplateAsset',$eWttOVZvZccDfFA); Shop::Smarty()->assign('snackysTemplateAsset',$eWttOVZvZccDfFA); } } function http2Push($hDYxSEllgaqgsbd,&$smarty) { if(isset($hDYxSEllgaqgsbd['file']) && isset($hDYxSEllgaqgsbd['as'])) header("Link: <".$hDYxSEllgaqgsbd['file'].">; rel=preload; as=".$hDYxSEllgaqgsbd['as']); } function checkShowMatrix($hDYxSEllgaqgsbd,&$smarty) { $DigmVBKRwkIxoFh = false; if(isset($hDYxSEllgaqgsbd['kundengruppen']) && isset($_SESSION['Kunde'])) { $aAFsNyKeCdZUIBR = explode(';',$hDYxSEllgaqgsbd['kundengruppen']); foreach($aAFsNyKeCdZUIBR as $hcIsymyXvKxbYsR) { if(intval(trim($hcIsymyXvKxbYsR)) == $_SESSION['Kunde']->kKundengruppe) $DigmVBKRwkIxoFh = true; } } if($DigmVBKRwkIxoFh == true) $smarty->assign('showMatrix',true); } function optimize($CQZEYORlzzecpGT) { $EoWgELdssLMnxsb = '/\<iframe(.*?)src=/i'; $VwUGjWIHYcjCUNg = '<iframe$jHxnGIvdfERekum-src='; $CQZEYORlzzecpGT = preg_replace($EoWgELdssLMnxsb,$VwUGjWIHYcjCUNg,$CQZEYORlzzecpGT); $EoWgELdssLMnxsb = '/\<img(.*?)src=/i'; $VwUGjWIHYcjCUNg = '<img$jHxnGIvdfERekum-src='; $CQZEYORlzzecpGT = preg_replace($EoWgELdssLMnxsb,$VwUGjWIHYcjCUNg,$CQZEYORlzzecpGT); return $CQZEYORlzzecpGT; } require_once(PFAD_ROOT.'/includes/libs/minify/lib/CSSmin.php'); function getZahlungsarten($hDYxSEllgaqgsbd, &$smarty) { if(isset($hDYxSEllgaqgsbd['cAssign'])) { $hYEtrmiSlhwfAOY = array(); $wxzsTzgQGYOkuYa = Shop::DB()->query('SELECT kZahlungsart FROM tversandartzahlungsart GROUP BY kZahlungsart',2); foreach($wxzsTzgQGYOkuYa as $cVrWQzGuVPnIjkl) { $JJfBPNqarAHLcFt = new Zahlungsart(); $JJfBPNqarAHLcFt->load($cVrWQzGuVPnIjkl->kZahlungsart); $hYEtrmiSlhwfAOY[] = $JJfBPNqarAHLcFt; } $smarty->assign($hDYxSEllgaqgsbd['cAssign'],$hYEtrmiSlhwfAOY); } return false; } function readJs($hDYxSEllgaqgsbd, &$smarty) { if(empty($hDYxSEllgaqgsbd['file'])) { $smarty->trigger_error('Missing file name to read within the template.', E_USER_ERROR); } $JPSFpmqTOZMcWxO = ''; if($smarty->template_exists($hDYxSEllgaqgsbd['file'])) { if(file_exists($smarty->template_dir['frontend'].$hDYxSEllgaqgsbd['file'])) $JPSFpmqTOZMcWxO = readfile($smarty->template_dir['frontend'].$hDYxSEllgaqgsbd['file']); else $JPSFpmqTOZMcWxO = readfile(PFAD_ROOT.'templates/snackys/'.$hDYxSEllgaqgsbd['file']); } return($JPSFpmqTOZMcWxO); } function checkCopyfree($CQZEYORlzzecpGT) { return $CQZEYORlzzecpGT!='XcUxIycWrh5GYSL5vg22WaluNKCiZgDN'; } function loadCSS($hDYxSEllgaqgsbd, &$smarty) { $qTXXYeUOynkkapr = array(); if(is_array($hDYxSEllgaqgsbd['css1'])) $qTXXYeUOynkkapr = array_merge($qTXXYeUOynkkapr,$hDYxSEllgaqgsbd['css1']); if(is_array($hDYxSEllgaqgsbd['css2'])) $qTXXYeUOynkkapr = array_merge($qTXXYeUOynkkapr,$hDYxSEllgaqgsbd['css2']); if(is_array($hDYxSEllgaqgsbd['css3'])) $qTXXYeUOynkkapr = array_merge($qTXXYeUOynkkapr,$hDYxSEllgaqgsbd['css3']); elseif(!empty($hDYxSEllgaqgsbd['css3'])) $qTXXYeUOynkkapr[] = $hDYxSEllgaqgsbd['css3']; $spPOrJpjbmpHnoz = $smarty->get_template_vars('currentTemplateDir'); $ULyeUouepISvZke = $smarty->get_template_vars('parentTemplateDir'); $vNWCzSwvzgCkiPs = $smarty->get_template_vars('Einstellungen'); $fdlKkGeoXwCTdhn = new Template(); $InvrIGVkMZVssvu = $fdlKkGeoXwCTdhn->leseXML(); $tabTTqTRArUnuBk = $InvrIGVkMZVssvu->CSSPageTypes; foreach($tabTTqTRArUnuBk as $o) foreach($o as $RwUDmmtUsXlvIZB) if($RwUDmmtUsXlvIZB->attributes()->PageType == $hDYxSEllgaqgsbd['cPageType'] || $RwUDmmtUsXlvIZB->attributes()->PageType == 'all') $qTXXYeUOynkkapr[] = str_replace('##theme##',$vNWCzSwvzgCkiPs['template']['theme']['theme_default'],$RwUDmmtUsXlvIZB->attributes()->Path); $qbBBFobrYmRTteI = ''; $kkoiObEQRuSkyrY = PFAD_ROOT.'templates/snackys/temp/main_inline_css_'.crc32(implode(';',$qTXXYeUOynkkapr)).'.css'; if(file_exists($kkoiObEQRuSkyrY) && !isset($_REQUEST['rebuildCache'])) $qbBBFobrYmRTteI = file_get_contents($kkoiObEQRuSkyrY); if($qbBBFobrYmRTteI == '') { $RwUDmmtUsXlvIZB = ''; foreach($qTXXYeUOynkkapr as $JPSFpmqTOZMcWxO) { $RwUDmmtUsXlvIZB .= file_get_contents(PFAD_ROOT.'/'.$JPSFpmqTOZMcWxO); } $sTGPcYPTDvWUwoj = array(); foreach($vNWCzSwvzgCkiPs['template']['css'] as $Rcnzqtpvfkcjsow => $QGxwTYdSaNTafnZ) $sTGPcYPTDvWUwoj['@'.$Rcnzqtpvfkcjsow] = $QGxwTYdSaNTafnZ; foreach($vNWCzSwvzgCkiPs['template']['pdListing'] as $Rcnzqtpvfkcjsow => $QGxwTYdSaNTafnZ) $sTGPcYPTDvWUwoj['@'.$Rcnzqtpvfkcjsow] = $QGxwTYdSaNTafnZ; $RwUDmmtUsXlvIZB = str_replace(array_keys($sTGPcYPTDvWUwoj), $sTGPcYPTDvWUwoj, $RwUDmmtUsXlvIZB); $QcpXNPbWUNbSZAQ = new CSSmin; $qbBBFobrYmRTteI = @$QcpXNPbWUNbSZAQ->run($RwUDmmtUsXlvIZB); file_put_contents($kkoiObEQRuSkyrY, $qbBBFobrYmRTteI); } $RwUDmmtUsXlvIZB = '<style type="text/css" id="maincss">'.$qbBBFobrYmRTteI.'</style>'; echo $RwUDmmtUsXlvIZB; } function getSizeBySrc($hDYxSEllgaqgsbd, &$smarty) { list($MwWPrImRoVReRsF, $QQKYiDCOMLBryVe, $qsIzeNGqasOBuHB, $OvqgUEwgHNKHTdW) = getimagesize($hDYxSEllgaqgsbd['src']); if(!$MwWPrImRoVReRsF) return; if(isset($hDYxSEllgaqgsbd['cAssign'])) $smarty->assign($hDYxSEllgaqgsbd['cAssign'], array('width' => $MwWPrImRoVReRsF, 'height' => $QQKYiDCOMLBryVe, 'padding' => ($QQKYiDCOMLBryVe / $MwWPrImRoVReRsF * 100))); return ; } function imagePreloadLogo($hDYxSEllgaqgsbd, &$smarty) { if (empty($hDYxSEllgaqgsbd['src'])) { return ''; } $IRDfiVnUETUYyhJ = get_image_size($hDYxSEllgaqgsbd['src']); $KHjSGRUFZQLYogX = $hDYxSEllgaqgsbd['src']; $JPBCbqgRrBaQaou = isset($hDYxSEllgaqgsbd['id']) ? ' id="' . $hDYxSEllgaqgsbd['id'] . '"' : ''; $fTThwqwyvpBtgbL = isset($hDYxSEllgaqgsbd['alt']) ? ' alt="' . truncate($hDYxSEllgaqgsbd['alt'], 75) . '"' : ''; $AnExMZeSwzcsESf = isset($hDYxSEllgaqgsbd['title']) ? ' title="' . truncate($hDYxSEllgaqgsbd['title'], 75) . '"' : ''; $xcqwumHaLgRHMxh = isset($hDYxSEllgaqgsbd['class']) ? ' class="' . truncate($hDYxSEllgaqgsbd['class'], 75) . '"' : ''; if ($IRDfiVnUETUYyhJ !== null && $IRDfiVnUETUYyhJ->size->width > 0 && $IRDfiVnUETUYyhJ->size->height > 0) { $YPvYOgxwNsdIsyx = intval(intval($IRDfiVnUETUYyhJ->size->height) / intval($IRDfiVnUETUYyhJ->size->width) * 100); if(!isset($hDYxSEllgaqgsbd['noAdd'])) $MdEtTUXhawDaZmO = '<style type="text/css">#logo .image-content:before{padding-top:'.$YPvYOgxwNsdIsyx.'%;}</style>'; return $MdEtTUXhawDaZmO.'<img data-src="' . $KHjSGRUFZQLYogX . '" width="' . $IRDfiVnUETUYyhJ->size->width . '" height="' . $IRDfiVnUETUYyhJ->size->height . '"' . $JPBCbqgRrBaQaou . $fTThwqwyvpBtgbL . $AnExMZeSwzcsESf . $xcqwumHaLgRHMxh . ' />'; } return '<img src="' . $KHjSGRUFZQLYogX . '"' . $JPBCbqgRrBaQaou . $fTThwqwyvpBtgbL . $AnExMZeSwzcsESf . $xcqwumHaLgRHMxh . ' />'; } ?>