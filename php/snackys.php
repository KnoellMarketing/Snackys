<?php
$bUmrjaxEfvuVTPN = Shop::DB()->query('SELECT nStatus FROM tplugin WHERE cVerzeichnis=\'km_snackys\'',1); if(!$bUmrjaxEfvuVTPN || !isset($bUmrjaxEfvuVTPN->nStatus) || $bUmrjaxEfvuVTPN->nStatus != 2) die('<html><head><title>Sorry</title><link
href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600,700" rel="stylesheet">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style type="text/css">
body {font-family:\'Source Sans Pro\',\'Helvetica Neue\',\'Helvetica\',\'Arial\',sans-serif;}
#box {max-width: 900px; margin: 0 auto;margin-top: 80px;width:80%;}
h2 {background: linear-gradient( 90deg, rgb(255,94,77) 0%, rgb(255,131,77) 0%, rgb(255,154,86) 0%, rgb(248,85,88) 100%); color: #fff;margin:0;padding: 20px 50px;}
p {padding: 50px; background: #f0f0f0;margin:0;}
</style></head><body><div id="box"><h2>Sorry.</h2><p>Plugin::Snackys is missing.</p></div></body></html>'); function loadConfigsSnackysTemplate() { $gtMGvxOJtmfNRfo = Shop::DB()->query('SELECT * FROM xplugin_km_snackys_config',2); $aAhltHEqJZatZQr = array(); foreach($gtMGvxOJtmfNRfo as $wJWDzjLPMKRCgtG) $aAhltHEqJZatZQr[$wJWDzjLPMKRCgtG->nKey] = $wJWDzjLPMKRCgtG->nValue; return $aAhltHEqJZatZQr; } $smarty->assign('snackyConfig',loadConfigsSnackysTemplate()); if(!isset($smarty->registered_plugins['function']['km_zone'])) { $smarty->registerPlugin('function', 'km_zone', 'km_empty_zone'); } try { $plugin = Plugin::getPluginById('kk_dropper'); if(!empty($plugin) && $plugin->nStatus == 2) $smarty->assign('dropperFound',1); }catch(Exception $e){} function km_empty_zone($qiQJvfUgQWURDKp,&$smarty){} $smarty->registerPlugin('function', 'getSliderPerDevice', 'getSliderPerDevice'); function getSliderPerDevice($qiQJvfUgQWURDKp, &$smarty) { $WOjrdeJQVgCMVSD = $smarty->get_template_vars('oSlider'); if(defined("APPLICATION_VERSION") && version_compare(APPLICATION_VERSION, 500) < 0) { $smarty->assign($qiQJvfUgQWURDKp['cAssign'],$WOjrdeJQVgCMVSD); return false; } if($WOjrdeJQVgCMVSD) { $hdjywiEitbiojij = $smarty->get_template_vars('nSeitenTyp'); $tutCrolpLjMLgMj = $smarty->get_template_vars('device'); $uScpbRRHlNfhKrZ = (isset($_SESSION['Kunde']->kKundengruppe) && $_SESSION['Kunde']->kKundengruppe > 0) ? $_SESSION['Kunde']->kKundengruppe : $_SESSION['Kundengruppe']->kKundengruppe; $slider_arr = Shop::DB()->query( "SELECT kInitial FROM textensionpoint
					WHERE
					 (kSprache = '".Shop::getLanguage()."' OR kSprache = 0)
						AND
					 (kKundengruppe = '".$uScpbRRHlNfhKrZ."' OR kKundengruppe = 0)
						AND
					 (nSeite = '".$hdjywiEitbiojij."' OR nSeite = 0)
						AND
					cClass='Slider'", 2 ); foreach($slider_arr as $HvDchxTPQpttkxz) { $hdjywiEitbiojij = $smarty->get_template_vars('nSeitenTyp'); $wRyxMUEROKOPURz = Shop::DB()->query('SELECT kSlider FROM tslider WHERE cName NOT LIKE "%#'.(($tutCrolpLjMLgMj->isMobile()) ? 'desktop' : 'mobile').'%" AND kSlider='.(int)$HvDchxTPQpttkxz->kInitial,1); if($wRyxMUEROKOPURz) { $LAWQYqhLETBoaVx = new Slider(); $LAWQYqhLETBoaVx->init((int)$HvDchxTPQpttkxz->kInitial); $smarty->assign($qiQJvfUgQWURDKp['cAssign'],$LAWQYqhLETBoaVx); break; } } } } $smarty->registerPlugin('function', 'loadCSS', 'loadCSS'); $smarty->registerPlugin('function', 'imagePreloadLogo', 'imagePreloadLogo'); $smarty->registerPlugin('function', 'getSizeBySrc', 'getSizeBySrc'); $smarty->registerPlugin('function', 'readJs', 'readJs'); $smarty->registerPlugin('function', 'getZahlungsarten', 'getZahlungsarten'); $smarty->registerPlugin('modifier', 'checkCopyfree', 'checkCopyfree'); $smarty->registerPlugin('modifier', 'optimize', 'optimize'); $smarty->registerPlugin('function', 'checkShowMatrix', 'checkShowMatrix'); $smarty->registerPlugin('function', 'snackys_content', 'snackys_content'); $smarty->registerPlugin('function', 'readSVG', 'readSVG'); function readSVG($qiQJvfUgQWURDKp,&$smarty) { if(empty($qiQJvfUgQWURDKp['file'])) { $smarty->trigger_error('Missing file name to read within the template.', E_USER_ERROR); } $PEGmsJrfgsLxVIr = ''; if(file_exists($qiQJvfUgQWURDKp['file'])) { $PEGmsJrfgsLxVIr = readfile($qiQJvfUgQWURDKp['file']); } return($PEGmsJrfgsLxVIr); } function snackys_content($qiQJvfUgQWURDKp,&$smarty) { $SQMKKNRaUGPAEBw = Shop::Smarty()->get_template_vars('snackyConfig'); if($SQMKKNRaUGPAEBw['show_content_ids'] == 'Y' && $qiQJvfUgQWURDKp['id'] == 'html_body_start') echo '<div class="dropper-box">Snackys Selektor: html_head_start<br>Snackys Selektor: html_head_end</div>'; if($SQMKKNRaUGPAEBw['show_content_ids'] == 'Y' && substr($qiQJvfUgQWURDKp['id'],0,10) != 'html_head_') echo "<div class=\"dropper-box\"><strong>Content Box ID</strong><br>Snackys Selektor: ".$qiQJvfUgQWURDKp['id']."<br>Dropper Selector: @snackys.".$qiQJvfUgQWURDKp['id']."<br>OPC Mount Point: opc_".$qiQJvfUgQWURDKp['id']."</div>"; $NlluYOYVQACLwAL = 'WHERE `nZone`=\''.trim($qiQJvfUgQWURDKp['id']).'\''; $hdjywiEitbiojij = $smarty->get_template_vars('nSeitenTyp'); $tutCrolpLjMLgMj = $smarty->get_template_vars('device'); $qmLBCOmqDOBNYtf = (isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] === 'on' ? "https" : "http") . "://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]"; $NlluYOYVQACLwAL .= ' AND (nDevice=0 OR nDevice='.( ($tutCrolpLjMLgMj->isMobile()) ? 1 : 2).')'; $NlluYOYVQACLwAL .= ' AND (nPagetype=0 OR nPagetype='.$hdjywiEitbiojij.')'; $NlluYOYVQACLwAL .= ' AND (nUrl=\'\' OR nUrl=\''.$qmLBCOmqDOBNYtf.'\')'; $oADnnEGiSZMAKcU = Shop::DB()->query('SELECT nType,nPHPIf,cClass,cContent FROM `xplugin_km_snackys_content` '.$NlluYOYVQACLwAL.' ORDER BY nSort ASC,cName ASC',2); if($oADnnEGiSZMAKcU) { foreach($oADnnEGiSZMAKcU as $vsoeodFoRPpRkSP) { $fzmptoqFxxUojFk = true; if(trim($vsoeodFoRPpRkSP->nPHPIf) != '') { try{ eval('$HRTSjHJqictaNgq = function(){'.$vsoeodFoRPpRkSP->nPHPIf.'};'); $fzmptoqFxxUojFk = $HRTSjHJqictaNgq(); } catch(Exception $e){$fzmptoqFxxUojFk = false;} } if($fzmptoqFxxUojFk) { $obkkWXOYyhIVUSY = ''; switch($vsoeodFoRPpRkSP->nType) { case 1: if($SQMKKNRaUGPAEBw['optimize_content'] == 'Y') $vsoeodFoRPpRkSP->cContent = optimize($vsoeodFoRPpRkSP->cContent); $obkkWXOYyhIVUSY = Shop::Smarty()->fetch('string:'.$vsoeodFoRPpRkSP->cContent); break; case 2: $GhaWPLaQOrHJijx = json_decode($vsoeodFoRPpRkSP->cContent); if(!isset($fWEXladigTTrIrX)) $fWEXladigTTrIrX = Artikel::getDefaultOptions(); if($GhaWPLaQOrHJijx) { $sYzUlIvcAhbWUHJ = explode(";",$GhaWPLaQOrHJijx->products); $rBAZFTlRFHVLTud = array(); foreach($sYzUlIvcAhbWUHJ as $TnPANMDNsQRIuqv) { $LqTKHBHatprXZUs = Shop::DB()->query('SELECT kArtikel FROM tartikel WHERE cArtNr=\''.trim($TnPANMDNsQRIuqv).'\' LIMIT 1',1); if($LqTKHBHatprXZUs) { $JcTllEpWkAFBPTE = new Artikel(); $JcTllEpWkAFBPTE->fuelleArtikel($LqTKHBHatprXZUs->kArtikel, $fWEXladigTTrIrX); $rBAZFTlRFHVLTud[] = $JcTllEpWkAFBPTE; } } $oIEOeekMIVMHrOV = $GhaWPLaQOrHJijx->title; Shop::Smarty()->assign('tempProducts',$rBAZFTlRFHVLTud); Shop::Smarty()->assign('tempTitle',$oIEOeekMIVMHrOV); $obkkWXOYyhIVUSY = '<div class="snackys-content '.$vsoeodFoRPpRkSP->cClass.'">'.Shop::Smarty()->fetch('string:{include file=\'snippets/product_slider.tpl\' productlist=$JxSAbEuvoCIQZGk title=$QOKHrRDwDoIxalk hideOverlays=true}').'</div>'; } break; default: $obkkWXOYyhIVUSY = '<div class="snackys-content '.$vsoeodFoRPpRkSP->cClass.'">'.$vsoeodFoRPpRkSP->cContent.'</div>'; break; } echo $obkkWXOYyhIVUSY; } } } } function checkShowMatrix($qiQJvfUgQWURDKp,&$smarty) { $oFfsSvMkBTwLVZx = $smarty->getTemplateVars('showMatrix'); if(isset($qiQJvfUgQWURDKp['kundengruppen']) && isset($_SESSION['Kunde']) && isset($_SESSION['Kunde']->kKundengruppe) && $_SESSION['Kunde']->kKundengruppe > 0) { $WBKeoLRRJZXeiad = explode(';',$qiQJvfUgQWURDKp['kundengruppen']); foreach($WBKeoLRRJZXeiad as $VCClqpVNPobPlSs) { if(intval(trim($VCClqpVNPobPlSs)) == $_SESSION['Kunde']->kKundengruppe) $oFfsSvMkBTwLVZx = true; } } if($oFfsSvMkBTwLVZx == true) $smarty->assign('showMatrix',true); } function optimize($CSgeFjaUYDPGdtf) { $pIYyPbZwnlhgILC = Shop::Smarty()->get_template_vars('snackyConfig'); $nULkbxqDapkFWDU = '/\<iframe(.*?)src=/i'; $OpPPGCdQBvzJQOD = ($pIYyPbZwnlhgILC) ? "<iframe src=\"".$pIYyPbZwnlhgILC['preloadImage']."\"$zffiHQzaKGitNdz-src=" : "<iframe$zffiHQzaKGitNdz-src="; $CSgeFjaUYDPGdtf = preg_replace($nULkbxqDapkFWDU,$OpPPGCdQBvzJQOD,$CSgeFjaUYDPGdtf); $nULkbxqDapkFWDU = '/\<img(.*?)src=/i'; $OpPPGCdQBvzJQOD = ($pIYyPbZwnlhgILC) ? "<img src=\"".$pIYyPbZwnlhgILC['preloadImage']."\"$zffiHQzaKGitNdz-src=" : "<img$zffiHQzaKGitNdz-src="; $CSgeFjaUYDPGdtf = preg_replace($nULkbxqDapkFWDU,$OpPPGCdQBvzJQOD,$CSgeFjaUYDPGdtf); return $CSgeFjaUYDPGdtf; } if(file_exists(PFAD_ROOT.'/includes/libs/minify/lib/CSSmin.php')) require_once(PFAD_ROOT.'/includes/libs/minify/lib/CSSmin.php'); function getZahlungsarten($qiQJvfUgQWURDKp, &$smarty) { if(isset($qiQJvfUgQWURDKp['cAssign'])) { $FKfdxyCjSBfoNND = array(); $vXPrJnhjZrrAoJY = Shop::DB()->query('SELECT kZahlungsart FROM tversandartzahlungsart GROUP BY kZahlungsart',2); foreach($vXPrJnhjZrrAoJY as $ftlMGLmrKdTkgLV) { $gacxFdxwdKyFjFF = new Zahlungsart(); $gacxFdxwdKyFjFF->load($ftlMGLmrKdTkgLV->kZahlungsart); $FKfdxyCjSBfoNND[] = $gacxFdxwdKyFjFF; } $smarty->assign($qiQJvfUgQWURDKp['cAssign'],$FKfdxyCjSBfoNND); } return false; } function readJs($qiQJvfUgQWURDKp, &$smarty) { if(empty($qiQJvfUgQWURDKp['file'])) { $smarty->trigger_error('Missing file name to read within the template.', E_USER_ERROR); } $PEGmsJrfgsLxVIr = ''; if($smarty->template_exists($qiQJvfUgQWURDKp['file'])) { if(file_exists($smarty->template_dir['frontend'].$qiQJvfUgQWURDKp['file'])) $PEGmsJrfgsLxVIr = readfile($smarty->template_dir['frontend'].$qiQJvfUgQWURDKp['file']); else $PEGmsJrfgsLxVIr = readfile(PFAD_ROOT.'templates/snackys/'.$qiQJvfUgQWURDKp['file']); } return($PEGmsJrfgsLxVIr); } function checkCopyfree($CSgeFjaUYDPGdtf) { return $CSgeFjaUYDPGdtf!='XcUxIycWrh5GYSL5vg22WaluNKCiZgDN'; } function loadCSS($qiQJvfUgQWURDKp, &$smarty) { $hocCNMxItlssEhs = array(); if(is_array($qiQJvfUgQWURDKp['css1'])) $hocCNMxItlssEhs = array_merge($hocCNMxItlssEhs,$qiQJvfUgQWURDKp['css1']); if(is_array($qiQJvfUgQWURDKp['css2'])) $hocCNMxItlssEhs = array_merge($hocCNMxItlssEhs,$qiQJvfUgQWURDKp['css2']); if(is_array($qiQJvfUgQWURDKp['css3'])) $hocCNMxItlssEhs = array_merge($hocCNMxItlssEhs,$qiQJvfUgQWURDKp['css3']); elseif(!empty($qiQJvfUgQWURDKp['css3'])) $hocCNMxItlssEhs[] = $qiQJvfUgQWURDKp['css3']; $AaHUCiawQWmMclh = $smarty->get_template_vars('currentTemplateDir'); $ILWllpXHnMXfLFi = $smarty->get_template_vars('parentTemplateDir'); $SQMKKNRaUGPAEBw = $smarty->get_template_vars('Einstellungen'); $XrwiXFpKuZhLBDq = $smarty->get_template_vars('snackyConfig'); $ripZYMLuURnInyF = new Template(); $alaNRJpYjwBjRWX = $ripZYMLuURnInyF->leseXML(); $YMDfEsboJbJZzkW = $alaNRJpYjwBjRWX->CSSPageTypes; if(!$YMDfEsboJbJZzkW) { $alaNRJpYjwBjRWX = $ripZYMLuURnInyF->leseXML($ripZYMLuURnInyF->getFrontendTemplate()); $YMDfEsboJbJZzkW = $alaNRJpYjwBjRWX->CSSPageTypes; } foreach($YMDfEsboJbJZzkW as $o) foreach($o as $WiINBCsjDXmzixe) if($WiINBCsjDXmzixe->attributes()->PageType == $qiQJvfUgQWURDKp['cPageType'] || $WiINBCsjDXmzixe->attributes()->PageType == 'all') { $KtVnHCHHsAyPIfG = str_replace('##theme##',$SQMKKNRaUGPAEBw['template']['theme']['theme_default'],$WiINBCsjDXmzixe->attributes()->Path); if(substr($KtVnHCHHsAyPIfG,0,1) != '/') $KtVnHCHHsAyPIfG = '/'.$AaHUCiawQWmMclh.$KtVnHCHHsAyPIfG; $hocCNMxItlssEhs[] = $KtVnHCHHsAyPIfG; } $QnIymbqMQJGcAnL = ''; $elgSffdZlLsHFSF = PFAD_ROOT.'templates/snackys/temp/main_inline_css_'.crc32(implode(';',$hocCNMxItlssEhs)).'.css'; if(file_exists($elgSffdZlLsHFSF) && !isset($_REQUEST['rebuildCache'])) $QnIymbqMQJGcAnL = file_get_contents($elgSffdZlLsHFSF); if($XrwiXFpKuZhLBDq['debug_mode'] == 'Y') $QnIymbqMQJGcAnL = ''; $ahvCqjUHCqTGDJv = array(); foreach($XrwiXFpKuZhLBDq as $ysGMktWKVJAPKXH => $EGiDfrkSavdjhMm) { if(substr($ysGMktWKVJAPKXH,0,4) == 'css_') $ahvCqjUHCqTGDJv[substr($ysGMktWKVJAPKXH,4)] = $EGiDfrkSavdjhMm; } if($QnIymbqMQJGcAnL == '') { $WiINBCsjDXmzixe = ''; foreach($hocCNMxItlssEhs as $PEGmsJrfgsLxVIr) { $WiINBCsjDXmzixe .= file_get_contents(PFAD_ROOT.'/'.$PEGmsJrfgsLxVIr); } $qHtimudsAHYcaNH = array(); foreach($ahvCqjUHCqTGDJv as $ZrTnawueNQjRDQp => $xgqVoJKlUFsMaeD) $qHtimudsAHYcaNH['@'.$ZrTnawueNQjRDQp] = $xgqVoJKlUFsMaeD; $WiINBCsjDXmzixe = str_replace(array_keys($qHtimudsAHYcaNH), $qHtimudsAHYcaNH, $WiINBCsjDXmzixe); if(!class_exists('CSSmin')) $QnIymbqMQJGcAnL = $WiINBCsjDXmzixe; else { $zocgqQifGBJyhce = new CSSmin; $QnIymbqMQJGcAnL = @$zocgqQifGBJyhce->run($WiINBCsjDXmzixe); } file_put_contents($elgSffdZlLsHFSF, $QnIymbqMQJGcAnL); } $WiINBCsjDXmzixe = '<style id="maincss">'.$QnIymbqMQJGcAnL.'</style>'; echo $WiINBCsjDXmzixe; } function getSizeBySrc($qiQJvfUgQWURDKp, &$smarty) { list($knWiLuBbqpvPAPd, $tSfLvrgXkWOlUuT, $IXNOxSdIxIVhnsd, $LFkCCPweHysjgpn) = getimagesize($qiQJvfUgQWURDKp['src']); if(!$knWiLuBbqpvPAPd) return; if(isset($qiQJvfUgQWURDKp['cAssign'])) $smarty->assign($qiQJvfUgQWURDKp['cAssign'], array('width' => $knWiLuBbqpvPAPd, 'height' => $tSfLvrgXkWOlUuT, 'padding' => ($tSfLvrgXkWOlUuT / $knWiLuBbqpvPAPd * 100))); return ; } function imagePreloadLogo($qiQJvfUgQWURDKp, &$smarty) { if (empty($qiQJvfUgQWURDKp['src'])) { return ''; } $EXCRHDpxlRBpzxU = get_image_size($qiQJvfUgQWURDKp['src']); $CtaSmoCvmZPwPJD = $qiQJvfUgQWURDKp['src']; $SRSoKrpMipmOxBx = isset($qiQJvfUgQWURDKp['id']) ? ' id="' . $qiQJvfUgQWURDKp['id'] . '"' : ''; $cKMzRZVoouNTbiI = isset($qiQJvfUgQWURDKp['alt']) ? ' alt="' . truncate($qiQJvfUgQWURDKp['alt'], 75) . '"' : ''; $uUzbtCoppEzpbNH = isset($qiQJvfUgQWURDKp['title']) ? ' title="' . truncate($qiQJvfUgQWURDKp['title'], 75) . '"' : ''; $flEVFlEzrunanIj = isset($qiQJvfUgQWURDKp['class']) ? ' class="' . truncate($qiQJvfUgQWURDKp['class'], 75) . '"' : ''; if ($EXCRHDpxlRBpzxU !== null && $EXCRHDpxlRBpzxU->size->width > 0 && $EXCRHDpxlRBpzxU->size->height > 0) { $QUVprTkMwcexjzs = intval(intval($EXCRHDpxlRBpzxU->size->height) / intval($EXCRHDpxlRBpzxU->size->width) * 100); if(!isset($qiQJvfUgQWURDKp['noAdd'])) $AwIwUvPNGpgovYg = '<style type="text/css">#logo .image-content:before{padding-top:'.$QUVprTkMwcexjzs.'%;}</style>'; return $AwIwUvPNGpgovYg.'<img data-src="' . $CtaSmoCvmZPwPJD . '" width="' . $EXCRHDpxlRBpzxU->size->width . '" height="' . $EXCRHDpxlRBpzxU->size->height . '"' . $SRSoKrpMipmOxBx . $cKMzRZVoouNTbiI . $uUzbtCoppEzpbNH . $flEVFlEzrunanIj . ' />'; } return '<img src="' . $CtaSmoCvmZPwPJD . '"' . $SRSoKrpMipmOxBx . $cKMzRZVoouNTbiI . $uUzbtCoppEzpbNH . $flEVFlEzrunanIj . ' />'; } ?>